steps:
  # ğŸ—ï¸ 1. ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - 'asia-northeast1-docker.pkg.dev/devops-sre-demo1/demo-repo/horse:latest'
      - '.'

  # ğŸ“¤ 2. Artifact Registry ã« push
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'push'
      - 'asia-northeast1-docker.pkg.dev/devops-sre-demo1/demo-repo/horse:latest'

  # ğŸš€ 3. Cloud Run ã«è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    id: 'deploy-to-run'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        echo "ğŸš€ Deploying to Cloud Run..."
        gcloud run deploy horse-demo \
          --image=asia-northeast1-docker.pkg.dev/devops-sre-demo1/demo-repo/horse:latest \
          --region=asia-northeast1 \
          --platform=managed \
          --allow-unauthenticated \
          --quiet

images:
  - 'asia-northeast1-docker.pkg.dev/devops-sre-demo1/demo-repo/horse:latest'
